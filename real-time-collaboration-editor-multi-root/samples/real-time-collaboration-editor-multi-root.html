<!DOCTYPE html>
<!--
Copyright (c) 2003-2022, CKSource Holding sp. z o.o. All rights reserved.
This file is licensed under the terms of the MIT License (see LICENSE.md).
-->
<html>

<head>
	<title>CKEditor 5 multi-root editor with collaboration features</title>

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" type="image/png" href="https://c.cksource.com/a/1/logos/ckeditor5.png">
	<link href="configuration-dialog/configuration-dialog.css" rel="stylesheet" type="text/css">
	<link href="./style.css" rel="stylesheet" type="text/css">
	<script src="../build/multirooteditor.js"></script>
	<script src="configuration-dialog/configuration-dialog.js"></script>

	<style>
		.content-wrapper {
			background: #fff;
			position: relative;
			display: flex;
			width: 100%;
		}

		.root-wrapper {
			width: 100%;
			padding: 20px;
			border: 1px solid hsl(0, 0%, 77%);
			border-top: 0;
		}

		.root {
			width: 100%;
			margin: 0 0 30px;
		}

		.root.ck-content:not(.ck-focused) {
			border: 1px solid rgba(0, 0, 0, 0.15);
		}

		.root-wrapper .root:last-child {
			margin: 0;
		}

		#root-header.ck-content {
			text-align: center;
		}

		#root-header.ck-content h2 {
			margin-bottom: 0;
			font-size: 1.9rem;
			font-weight: normal;
		}

		#root-header.ck-content h3 {
			color: rgba(5, 22, 42, 0.59);
			font-weight: 600;
			font-size: 1.4rem;
		}

		.toolbar-container {
			display: flex;
			width: 100%;
			justify-content: space-between;
		}

		.toolbar-container .presence,
		.toolbar-container #toolbar {
			width: 100%;
		}

		.toolbar-container .presence {
			max-width: 300px;
			border-top: 1px solid hsl(0, 0%, 77%);
		}
	</style>
</head>

<body>
	<header>
		<div class="centered">
			<h1>
				<a href="https://ckeditor.com/ckeditor-5/" target="_blank" rel="noopener noreferrer">
					<img src="https://c.cksource.com/a/1/logos/ckeditor5.svg" alt="CKEditor 5 logo" /> CKEditor 5
				</a>
			</h1>

			<nav>
				<ul>
					<li><a href="https://ckeditor.com/docs/ckeditor5/latest/features/collaboration/collaboration.html"
							target="_blank" rel="noopener noreferrer">Collaboration documentation</a></li>
					<li><a href="https://ckeditor.com/docs/ckeditor5/latest/framework/guides/deep-dive/ui/custom-editor-creator.html"
							target="_blank" rel="noopener noreferrer">Multi-root editor documentation</a></li>
					<li><a href="https://ckeditor.com/collaboration/" target="_blank"
							rel="noopener noreferrer">Website</a></li>
				</ul>
			</nav>
		</div>
	</header>

	<main>
		<div class="message">
			<div class="centered">
				<h2>CKEditor 5 multi-root editor with collaboration features</h2>
				<p>
					Open this sample in another browser tab to start real-time collaborative editing.
				</p>
			</div>
		</div>

		<div class="centered">
			<div class="container">
				<div class="row row-presence">
					<div class="presence"></div>
				</div>

				<div class="toolbar-container">
					<div id="toolbar"></div>
				</div>

				<div class="content-wrapper">

					<div class="root-wrapper">
					  
						<div id="root-content1" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
                        
						<div id="root-content2" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>

						<div id="root-content3" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
						
						<div id="root-content4" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
                        
						<div id="root-content5" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
						
						<div id="root-content6" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>

						<div id="root-content7" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
                        
						<div id="root-content8" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>

						<div id="root-content9" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
						
						<div id="root-content10" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
                        
						<div id="root-content11" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
						
						<div id="root-content12" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>

						<div id="root-content13" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
                        
						<div id="root-content14" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>

						<div id="root-content15" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
						
						<div id="root-content16" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
                        
						<div id="root-content17" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
						
						<div id="root-content18" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>

						<div id="root-content19" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
                        
						<div id="root-content20" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>

						<div id="root-content21" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
						
						<div id="root-content22" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
                        
						<div id="root-content23" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>
						
						<div id="root-content24" class="root">
							<h3>This theme covers the transition from reactive and unstandardized work to the rigorous application of standard work in order to maintain and improve line performance. The daily management systems and standard work processes are deployed, applied and improved over the maturity of this theme.</h3>
						</div>


					</div>

					<div class="sidebar-container">
						<div class="sidebar"></div>
					</div>
				</div>
			</div>
		</div>
	</main>

	<footer>
		<div class="centered">
			<p><a href="https://ckeditor.com/ckeditor-5/" target="_blank" rel="noopener">CKEditor 5</a> – Rich text editor of			tomorrow, available today</p>
			<p>Copyright © 2003-2022, <a href="https://cksource.com/" target="_blank" rel="noopener">CKSource</a> – Holding
				sp. z o.o. All rights reserved.</p>
		</div>
	</footer>

	<script>
		/* globals MultiRootEditor */

		const { EditorWatchdog, CKEditorCS: Editor } = CKEditorCS;

		// Configuration data needed to initialize the editor is available only after the configuration dialog
		// is submitted, hence the editor is initialized inside a promise returned by `createDialog()`.
		window.createDialog().then( cloudServicesConfig => {
			createEditor( cloudServicesConfig );
		} );

		const watchdog = new EditorWatchdog();

		watchdog.setCreator( ( elements, config ) => {
			return Editor.create( elements, config )
				.then( editor => {
					document.querySelector( '#toolbar' ).appendChild( editor.ui.view.toolbar.element );

					// Switch between inline, narrow sidebar and wide sidebar according to the window size.
					const annotationsUIs = editor.plugins.get( 'AnnotationsUIs' );
					const sidebarElement = document.querySelector( '.sidebar' );

					// Prevent closing the tab when any action is pending.
					editor.ui.view.listenTo( window, 'beforeunload', ( evt, domEvt ) => {
						if ( editor.plugins.get( 'PendingActions' ).hasAny ) {
							domEvt.preventDefault();
							domEvt.returnValue = true;
						}
					} );

					editor.ui.view.listenTo( window, 'resize', refreshDisplayMode );
					refreshDisplayMode();

					function refreshDisplayMode() {
						if ( window.innerWidth < 1000 ) {
							sidebarElement.classList.remove( 'narrow' );
							sidebarElement.classList.add( 'hidden' );
							annotationsUIs.switchTo( 'inline' );
						}
						else if ( window.innerWidth < 1300 ) {
							sidebarElement.classList.remove( 'hidden' );
							sidebarElement.classList.add( 'narrow' );
							annotationsUIs.switchTo( 'narrowSidebar' );
						}
						else {
							sidebarElement.classList.remove( 'hidden', 'narrow' );
							annotationsUIs.switchTo( 'wideSidebar' );
						}
					}

					setTimeout(() => {
						
						const documentContent = {};
						
						for (const e of editor.model.document.getRootNames()){ 
							documentContent[e] = editor.data.get({ rootName: e });
						}
                          
						console.log('Document content: ', documentContent);
					});

					return editor;
				} );
		} );

		watchdog.setDestructor( editor => {
			document.querySelector( '#toolbar' ).removeChild( editor.ui.view.toolbar.element );

			return editor.destroy();
		} );

		function createEditor( cloudServicesConfig ) {

            const roots = {};

			for (var i = 1; i < 25; i++) {

				roots[`rootContent${i}`] = document.querySelector( `#root-content${i}`);
			}

			console.log(roots);

			return watchdog
				// Note: All roots should be rendered in the DOM in the same order
				// as they have been added to the editor and should be displayed
				// in separate rows (this is a temporary limitation).
				//
				// Valid:
				//
				// \----------\
				// |  ROOT 1  |
				// \----------\
				//
				// \----------\
				// |  ROOT 2  |
				// \----------\
				//
				// \----------\
				// |  ROOT 3  |
				// \----------\
				//
				//
				// Invalid:
				//
				// \----------\
				// |  ROOT 3  |
				// \----------\
				//
				// \----------\  \----------\
				// |  ROOT 2  |  |  ROOT 1  |
				// \----------\  \----------\
				.create( 
				  roots
				, {
					cloudServices: {
						tokenUrl: cloudServicesConfig.tokenUrl,
						uploadUrl: cloudServicesConfig.uploadUrl,
						webSocketUrl: cloudServicesConfig.webSocketUrl,
						bundleVersion: '35.2.1_multi_root'
					},
					collaboration: {
						channelId: cloudServicesConfig.channelId
					},
					sidebar: {
						container: document.querySelector( '.sidebar' )
					},
					presenceList: {
						container: document.querySelector( '.presence' )
					}
				} );
		}
	</script>
</body>

</html>
